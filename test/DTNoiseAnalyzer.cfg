process PROD = {

    include "CondCore/DBCommon/data/CondDBSetup.cfi"
    include "Geometry/MuonCommonData/data/muonIdealGeometryXML.cfi"
    include "Geometry/DTGeometry/data/dtGeometry.cfi"
    include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"

    source = DaqSource{ 
        untracked string readerPluginName = "DTDDUFileReader"
        untracked PSet readerPset = {
             untracked string fileName ="/tmp/giorgia/Noise_20mV_W0_S23671011_vmepcs2g18-16_r34163.i0"
             untracked bool isRaw = true
             untracked int32 numberOfHeaderWords = 10
        }
    }

    untracked PSet maxEvents = {untracked int32 input = 50000}

    #unpacker
    module dtunpacker = DTUnpackingModule{
       string dataType = "DDU"
       untracked bool fedbyType = true
       untracked bool useStandardFEDid = true
       PSet readOutParameters  = {
          untracked bool localDAQ = true
          untracked bool performDataIntegrityMonitor = false
          untracked bool debug = false
          PSet rosParameters = {
            untracked bool localDAQ = true
            untracked bool readingDDU = true
            untracked bool writeSC = true
            untracked bool readDDUIDfromDDU = true
            untracked bool performDataIntegrityMonitor = false
            untracked bool debug = false
            }
        }
    }

    include "FWCore/MessageService/data/MessageLogger.cfi"


    #mapping
    es_source roMapping = PoolDBESSource {
    using CondDBSetup
    string connect = "sqlite_file:/afs/cern.ch/cms/Physics/muon/CMSSW/DT/SQLLite/TestYB0/channelsMap_new/mapWh0.db"
    untracked uint32 authenticationMethod = 0
    VPSet toGet = {{
            string record = "DTReadOutMappingRcd"
            string tag = "channelsMap"
        }}
    }

   
    #tTrig (you need of this database only if you run with cosmicRun=true and readDB=true)
#    es_source tTrigMapping = PoolDBESSource {
#    using CondDBSetup
#    string connect =  "sqlite_file:ttrig.db"
#    string timetype = "runnumber"
#    untracked uint32 authenticationMethod = 0
#    VPSet toGet = {{
#            string record = "DTTtrigRcd"
#            string tag = "ttrig"
#        }}
#    }


    # Noise channels into DB
    service = PoolDBOutputService{
	using CondDBSetup
	string connect = "sqlite_file:noise.db"
	untracked string timetype = "runnumber"    
	untracked uint32 authenticationMethod = 0
	VPSet toPut={{
		# Noise
		string record = "DTStatusFlagRcd"
		string tag ="noise"
	   }}
    }


    #module to make the plots for noise studies
    module noiseCalib = DTNoiseCalibration {
       #Switch on/off the verbosity
       untracked bool debug = false
       #Total number of events
       untracked int32 TotEvents = 50000
       #Define the analysis type
       untracked bool fastAnalysis = true
       #Define the wheel of interest (to set if fastAnalysis=false)
       untracked int32 wheel = 0
       #Define the sector of interest (to set if fastAnalysis=false)
       untracked int32 sector = 11
       #Trigger mode
       untracked bool cosmicRun = false
       #Database option (to set if cosmicRun=true)
       untracked bool readDB = false
       #The trigger width(TDC counts) (to set if cosmicRun=true and readDB=false)
       untracked int32 defaultTtrig = 4000
       #The trigger width(ns) (to set if cosmicRun=false)
       untracked int32 TriggerWidth = 25350
       #Name of the ROOT file which will contains the 
       untracked string rootFileName = "DTNoiseCalib.root"
    }


    #module to compute noise from the plots done by DTNoiseCalibration
    module noiseComp = DTNoiseComputation {
       # Switch on/off the verbosity
       untracked bool debug = false
       #Define the analysis type
       untracked bool fastAnalysis = false
       #Total number of events	
       untracked int32 MaxEvents = 50000
       #Name of the ROOT file which contains the time boxes
       untracked string rootFileName = "DTNoiseCalib.root"
       #Name of the ROOT file which will contains the
       untracked string newRootFileName = "DTNoiseComp.root"
    }

    path p = {dtunpacker,noiseCalib}

}
