process DTVDriftCalibrationFromSimHits = {

	source = PoolSource{
			    untracked vstring fileNames = {'file:/data/simuSamples/mu_single_mu_pt_10-100_negative_10k.root'}
		            untracked int32 maxEvents = 200
		  	    untracked uint32 debugVebosity = 1
                	    untracked bool   debugFlag     = true
        		   }

        include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
        include "Geometry/MuonCommonData/data/muonIdealGeometryXML.cfi"
        include "Geometry/DTGeometry/data/dtGeometry.cfi"
	
	# The ttrig from DB
	include "TTrig_PoolDBESSource.cfi"

	#use CosmicData algos in order to use ttrig from DB (but you have to change some param. in the cfi files !)
	# DT 1D RecHits
  	include "RecoLocalMuon/DTRecHit/data/dt1DRecHits_LinearDrift_CosmicData.cfi"	
	replace dt1DRecHits.dtDigiLabel = "muonDTDigis"

  	# DT 2D Segments
  	include "RecoLocalMuon/DTSegment/data/dt2DSegments_CombPatternReco2D_LinearDrift_CosmicData.cfi"

  	# DT 4D Segments
  	include "RecoLocalMuon/DTSegment/data/dt4DSegments_CombPatternReco4D_LinearDrift_CosmicData.cfi"

	module dtvdriftcalibration = DTVDriftCalibration {
		# Switch on/off the verbosity
		untracked bool debug = true
		# Choose to calculate vDrift and t0 or just fill the TMax histograms
		untracked bool findVDriftAndT0 = false
		# Choose the chamber you want to calibrate (default = "All"), specify the chosen chamber
		# in the format "wheel station sector" (i.e. "-1 3 10")
		untracked string calibChamber = "All" 
		# Label to retrieve 4D segments from the event
		untracked string recHits4DLabel = 'dt4DSegments'
		# Name of the ROOT file which will contain the TMax histos
		untracked string rootFileName = "DTTMaxHistos.root"
		# Name of the txt file which will contain the calibrated v_drift
		untracked string  vDriftFileName = "DTVDriftPostCalibration_prova20k.txt"
		# Chosen granularity (N.B. bySL is the only one implemented at the moment)  
		untracked string tMaxGranularity = "bySL" 
		#  Parameter set for  DTCalibrationMap constructor
		untracked PSet calibFileConfig = {}
		# Swicth on/off the checking of noisy channels
		untracked bool checkNoisyChannels = false
		# The Maximum allowed chi2 for 4D Segment reconstruction 
		double maxChi2 = 1000.0 
		# The Maximum incident angle for Phi Seg 
		double maxAnglePhi = 999
		# The Maximum incident angle for Theta Seg 
		double maxAngleZ = 999
		# Module for t0 subtraction
       		untracked string tTrigMode = 'DTTTrigSyncFromDB'
		untracked PSet tTrigModeConfig = {
			untracked bool debug = false
			# The ttrig from the time box fit is defined as mean + kFactor * sigma
			double kFactor = -1.0
			# The velocity of signal propagation along the wire (cm/ns)
			double vPropWire = 24.4
			# Switch on/off the T0 corrections from pulses
			bool doT0Correction = false   
			# Switch on/off the TOF correction for particles
			bool doTOFCorrection = true   
			# Switch on/off the correction for the signal propagation along the wire
			bool doWirePropCorrection  = true   
		}	
 	}
	
	path p = {dt1DRecHits, dt2DSegments, dt4DSegments, dtvdriftcalibration}

}

